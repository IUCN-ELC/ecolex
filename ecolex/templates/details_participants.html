{% extends 'layout.html' %}
{% load tags %}

{% block style %}
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.10/css/jquery.dataTables.min.css">
{% endblock %}

{% block breadcrumbs %}
  {% breadcrumb "Search results" 'results' query %}
  {% breadcrumb "Treaty" 'treaty_details' query id=treaty.id %}
  {% breadcrumb "Country/Participant" %}
{% endblock %}

{% block content %}
<p>
  <span class="treaty-name">{{ treaty.full_title|safe }}</span>
</p>

<hr>

<article class="record-details-participants">
  <header>
    <h1>Country/Participant</h1>
  </header>

  <div class="table-wrapper">
    <table class="table table-bordered" id="country-party">
      <thead>
        <tr>
          <th class="col-country">Countries</th>
          {% for event_name in treaty.participants.events %}
          <th>{{ event_name|capfirst }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for participant in treaty.participants.participants %}
          <tr>
            <th>{{ participant.country }}</th>
            {% for event_name in treaty.participants.events %}
              {% with participant.events|lookup:event_name as event %}
                {% if event.date %}
                  <td data-order="{{ event.date|parse_date|total_seconds }}"
                      title="{{ event.subgroup|default:event_name|capfirst }} date">
                    {{ event.date|parse_date|date:"b j, Y"|capfirst }}
                    {% if event.idx %}[{{ event.idx }}]{% endif %}
                  </td>
                {% else %}
                  <td title="Not available">-</td>
                {% endif %}
              {% endwith %}
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <br>
  {% include 'bits/participants_legend.html' with events=treaty.participants.events %}

</article>
{% endblock %}

{% block endscripts %}
  <script src="/static/js/jquery.dataTables.min.js"></script>
  <script>
    $(document).ready(function(){
      $('#country-party').DataTable( {
        "paging":  false,
        "info":    false,
        "bFilter": false,
      });
    });
  </script>
{% endblock %}
