{% load tags %}
{% load i18n %}

{% include 'bits/type_facet.html' %}

{% if suggestions %}
<p id="suggestion">
  <em>{% trans 'Did you mean:' %} {% for suggestion in suggestions %}{% if not forloop.first  %} / {% endif %}
    <a href="{% url "results" %}?{{ form.q|field_urlencoded:suggestion }}">{{ suggestion }}</a>
  {% endfor %}?</em>
</p>
{% endif %}

<p class="small clearfix">
  {# Ugly #}
    {% trans 'Found' %} <span id="number-of-results">{{ results.count|default:"no" }}</span>
    {% if form.type.data|length != 1 %}
      {% trans 'result' %}{{ results.count|pluralize }}.
    {% elif 'treaty' in form.type.data %}
      treat{{ results.count|pluralize:"y,ies" }}.
    {% elif 'decision' in form.type.data %}
      {% trans 'COP decision' %}{{ results.count|pluralize }}.
    {% elif 'literature' in form.type.data %}
      {% trans 'literature item' %}{{ results.count|pluralize }}.
    {% elif 'court_decision' in form.type.data %}
      {% trans 'court decision' %}{{ results.count|pluralize }}.
    {% elif 'legislation' in form.type.data %}
      {% trans 'legislation record' %}{{ results.count|pluralize }}.
    {% else %}
      {{ form.type.data|join:" or " }} thing, really.
    {% endif %}
{% if results %}
  {% with facets.type|get_facet_counts as type_count %}
    {% trans 'Show only' %}
    {% for id, txt in form.fields.type.choices %}{% if not forloop.first %} | {% endif %}
      {% with type_count|lookup:id as count %}
        {% if count %}
          <a href="{% url "results" %}?{{ form.type|field_urlencoded:id }}">
        {% endif %}

        {% if id == "treaty" %}{% trans 'Treaties' %}
        {% elif id == "decision" %}{% trans 'COP Decisions' %}
        {% elif id == "legislation" %}{% trans 'Legislation' %}
        {% elif id == "court_decision" %}{% trans 'Court Decisions' %}
        {% elif id == "literature" %}{% trans 'Literature' %}
        {% endif %}

        {% if count %}
          </a>
        {% endif %}
      {% endwith %}
    {% endfor %}
  {% endwith %}
</p>
<p class="small clearfix">
    {% include 'bits/sortby.html' %}
</p>
{% endif %}
</p>

{% if results  %}
<hr>
{% if form.type.data|length == 1 and 'decision' in form.type.data %}
  {% include 'bits/disclaimer.html' with class='InforMEA-disclaimer' %}
{% endif %}

<ul class="search-results">
  {% for result in results %}
    {% include "bits/search_result.html" with result=result results=results %}
  {% endfor %}
</ul>

<hr>

<div class="clearfix">

  {% if pages.count %}

    <div class="pull-right">

      <a class="btn btn-sm btn-default"
         href="?{{ pages.prev_url }}"
         {% if pages.number == 1 %}disabled{% endif %}>{% trans 'Previous' %}</a>

        {% if 1 not in pages.list%}
            <a class="btn btn-sm btn-default"
               href="?{{ pages.first_url }}">1</a>
             ...
        {% endif %}
        {% for page_no in pages.list %}
            {% if page_no != pages.number %}
                <a class="btn btn-sm btn-default"
                   href="?{{ pages.urls|lookup:page_no }}">{{ page_no }}</a>
            {% else %}
                <a class="btn btn-sm btn-default"
                   href="?{{ pages.urls|lookup:page_no }}" disabled>
                    <b>{{ page_no }}</b>
                </a>
            {% endif %}
        {% endfor %}
        {% if pages.count not in pages.list%}
            {% if pages.count|add:"-1" not in pages.list %}
             ...
            {% endif %}
            <a class="btn btn-sm btn-default"
               href="?{{ pages.last_url }}">{{ pages.count }}</a>
        {% endif %}

      <a class="btn btn-sm btn-default"
         href="?{{ pages.next_url }}"
         {% if pages.number == pages.count %}disabled{% endif %}>{% trans 'Next' %}</a>

    </div>

  {% else %}

  <div class="form-control-static">{% trans 'No more results' %}</div>

  {% endif %}


</div>
{% endif %}{# /if results  #}
