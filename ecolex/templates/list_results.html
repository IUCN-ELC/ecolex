{% extends "search.html" %}

{% block main %}
  <h4>Total of {{ results.count }} results</h4>
  <div class="btn-group btn-group-sm filter-type">
    <!-- Treaty filter -->
    <button type="button"
            class="btn btn-default {% if 'treaty' in form.type.data and form.type.data|length != 2 %}active{% endif %}"
            data-filter="#treaty-fieldset"
            data-toggle="tooltip"
            data-placement="bottom"
            data-container="body"
            data-value="treaty"
            {% if not 'treaty' in form.type.data %}
            title="Show Treaty"
            {% else %}
            title="Hide Treaty"
            {% endif %}>
      <span class="icon icon-treaty"></span>
      {% if facets.type.treaty > 0 %}
        <span class="badge">{{ facets.type.treaty }}</span>
      {% endif %}
      <span class="btn-label">Treaties</span>
    </button>

    <!-- COP decision filter -->
    <button type="button"
            class="btn btn-default {% if 'decision' in form.type.data and form.type.data|length != 2 %}active{% endif %}"
            data-filter="#copdecision-fieldset"
            data-toggle="tooltip"
            data-placement="bottom"
            data-container="body"
            data-value="decision"
            {% if not 'decision' in form.type.data %}
            title="Show COP Decisions"
            {% else %}
            title="Hide COP Decisions"
            {% endif %}>
      <span class="icon icon-cop-decision"></span>
      {% if facets.type.decision > 0 %}
      <span class="badge">{{ facets.type.decision }}</span>
      {% endif %}
      <span class="btn-label">COP Decisions</span>
    </button>

    <!-- Legislation filter -->
    <button type="button"
            class="btn btn-default"
            data-filter
            data-toggle="tooltip"
            data-placement="bottom"
            data-container="body"
            title="Hide Legislation"
            disabled>
      <span class="icon icon-legislation"></span>
      <span class="badge"></span>
      <span class="btn-label">Legislation</span>
    </button>

    <!-- Court decision filter -->
    <button type="button"
            class="btn btn-default"
            data-filter
            data-toggle="tooltip"
            data-placement="bottom"
            data-container="body"
            title="Hide Court Decisions"
            disabled>
      <span class="icon icon-court-decision"></span>
      <span class="badge"></span>
      <span class="btn-label">Court Decisions</span>
    </button>

    <!-- Literature filter -->
    <button type="button"
            class="btn btn-default"
            data-filter
            data-toggle="tooltip"
            data-placement="bottom"
            data-container="body"
            title="Hide Literature"
            disabled>
      <span class="icon icon-literature"></span>
      <span class="badge"></span>
      <span class="btn-label">Literature</span>
    </button>
  </div>

  <!-- To do -->
  <!-- <button data-toggle="offcanvas" data-target="#filters" data-canvas="body"></button> -->

  <ul class="search-results">
  {% for result in results %}
    {% include "bits/search_result.html" with result=result %}
  {% endfor %}
  </ul>

  <hr>

  {% if page.pages %}
  <div class="pagination">
      <span class="step-links">
          {% if page.number > 1 %}
              <a href="?{{ page.prev_url }}">previous</a>
          {% endif %}

          <span class="current">
              Page {{ page.number }} of {{ page.pages }}.
          </span>

          {% if page.number < page.pages %}
              <a href="?{{ page.next_url }}">next</a>
          {% endif %}
      </span>
  </div>
  {% endif %}
{% endblock %}

{% block sidebar %}
  <h4>Refine search</h4>

    {% if 'treaty' in form.type.data and facets.type.treaty > 0 %}
    <fieldset class="special-filter">
      <h5 data-toggle="collapse"
          data-target="#filter-treaties">Treaty filters</h5>

      <div id="filter-treaties" class="collapse in">
        {% if facets.trTypeOfText %}
        <h6>Type of document</h6>
        <ul class="filter-treaty" data-formid="#id_tr_type">
          {% include 'bits/checkbox_facet.html' with facet=facets.trTypeOfText form_field=form.tr_type %}
        </ul>
        {% endif %}

        <h6>Field of application</h6>
        <ul class="filter-treaty" data-formid="#id_tr_field">
          {% include 'bits/checkbox_facet.html' with facet=facets.trFieldOfApplication form_field=form.tr_field  %}
        </ul>

        <h6>Participants</h6>
        <select id="tr_party" multiple="multiple" data-formid="#id_tr_party">
          {% include 'bits/select_facet.html' with facet=facets.partyCountry form_field=form.tr_party %}
        </select>

        <h6>Subject</h6>
        <select id="tr_subject" multiple="multiple" data-formid="#id_tr_subject">
          {% include 'bits/select_facet.html' with facet=facets.trSubject form_field=form.tr_subject %}
        </select>
      </div>
    </fieldset>
    {% endif %}

    {% if 'decision' in form.type.data and facets.type.decision > 0 %}
    <fieldset class="special-filter">
      <h5 data-toggle="collapse"
          data-target="#filter-cop-decisions">COP Decision filters</h5>

      <div id="filter-cop-decisions" class="collapse in">
        {% if facets.decType %}
          <h6>Type of document</h6>
          <ul class="filter-decision" data-formid="#id_dec_type">
            {% include 'bits/checkbox_facet.html' with facet=facets.decType form_field=form.dec_type %}
          </ul>
        {% endif %}

        <h6>Decision status</h6>
        <ul class="filter-decision" data-formid="#id_dec_status">
          {% include 'bits/checkbox_facet.html' with facet=facets.decStatus form_field=form.dec_status %}
        </ul>

        <h6>Treaty</h6>
        <div class="indent">
          <select id="dec_treaty" multiple="multiple" data-formid="#id_dec_treaty">
            {% include 'bits/select_facet.html' with facet=facets.decTreatyId type_map=dec_treaty_names form_field=form.dec_treaty %}
          </select>
        </div>
      </div>
    </fieldset>
    {% endif %}

    <fieldset class="global-filter">
      <h5>Keywords</h5>
      <select id="keyword" multiple="multiple" data-formid="#id_keyword">
        {% include 'bits/select_facet.html' with facet=facets.docKeyword form_field=form.keyword %}
      </select>
    </fieldset>

    <fieldset class="global-filter hidden">
      <h5>Years</h5>
      <div class="indent">
        <input id="filter-years" type="text"
               data-slider-min="1896"
               data-slider-max="2015"
               data-slider-value="[1896,2015]"
               data-slider-tooltip="hide"/>
        <!-- <div class="row">
          <div class="form-group col-xs-6">
            <label for="year-min">From</label>
            <input class="form-control" id="year-min" type="number" placeholder="1856">
          </div>
          <div class="form-group col-xs-6">
            <label for="year-max">To</label>
            <input class="form-control" id="year-max" type="number" placeholder="2015">
          </div>
        </div> -->
      </div>
    </fieldset>
{% endblock %}
