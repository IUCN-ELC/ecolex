{% load tags %}

<input class="btn btn-default btn-sm btn-block" type="reset" value="Reset all filters">

{% comment %}
<script>
//{# not using this momentarily #}
var _FACETS_PAGE_SIZE = {{ settings.FACETS_PAGE_SIZE }};
</script>
{% endcomment %}

{# TODO: please move me to my proper place #}
<style>
/* avoid flicker before initialiazing */
select.selection-facet {
  height: 32px; /* pretty random, eh? */
  border: none;
  padding: 0;
  visibility: hidden;
}

.select2-container {
  display: block;
  clear: both;
}

/* this is a bad fix to https://github.com/select2/select2/issues/1538 */
.select2-results__option[aria-selected=true] {
  display: none;
}


/* mimic the old look */
.select2-container .select2-selection {
  border: none !important;
}

.select2-container .select2-selection .select2-selection__rendered {
  padding: 0;
}

.select2-selection__choice {
  clear: left;
}
.select2-search--inline {
  clear: left;
  float: none;
}

.select2-container .select2-dropdown {
  border: 1px solid #eee !important;
  border-radius: 3px;
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
  box-sizing: content-box;

  font-size: 14px;
  line-height: 1.2;
}

.select2-container--default .select2-results__option {
  margin: 0;
  padding: 6px 10px;
}

.select2-container--default .select2-results__option div.pull-right {
  margin-left: 3px;
}

.select2-container--default .select2-results__option--highlighted[aria-selected] {
  color: #141414;
  background-color: #f5f5f5;
  box-shadow: inset 2px 0 0 #1c5479;
}

/* prevent highlighted matches from dancing around */
.select2-container .select2-results__option strong {
  font-weight: normal;
  color: #000;
  /*text-shadow: 1px 0 0 #000;*/
  /*text-decoration: underline;*/
  border-bottom: 1px solid #1c5479;
}

</style>


<fieldset class="global-filter">
  <h5 data-toggle="collapse"
      data-target="#filter-global">Common filters</h5>
  <div id="filter-global" class="collapse in">

{% include "bits/selection_facet.html" with title="Subject" placeholder="Add subjects…" viewname="api:xsubjects-list" facet=facets.xsubjects field=form.xsubjects op_field=form.xsubjects_and_ %}

{% include "bits/selection_facet.html" with title="Keywords" placeholder="Add keywords…" viewname="api:xkeywords-list" facet=facets.xkeywords field=form.xkeywords op_field=form.xkeywords_and_ %}

{% include "bits/selection_facet.html" with title="Country" placeholder="Add countries…" viewname="api:xcountry-list" facet=facets.xcountry field=form.xcountry op_field=form.xcountry_and_ %}

{% include "bits/selection_facet.html" with title="Geographical Area" placeholder="Add geographical areas…" viewname="api:xregion-list" facet=facets.xregion field=form.xregion op_field=form.xregion_and_ %}

{% include "bits/selection_facet.html" with title="Language" placeholder="Add languages…" viewname="api:xlanguage-list" facet=facets.xlanguage field=form.xlanguage op_field=form.xlanguage_and_ %}

{% with dmin=stats.xdate.min dmax=stats.xdate.max %}
      <div class="filter-header">
        <h6>Year / Period</h6>
      </div>
      <input id="slider-years" type="text"
             data-slider-min="{{ dmin }}"
             data-slider-max="{{ dmax }}"
             data-slider-value="[{{ form.xdate_min.data|default:dmin }},{{ form.xdate_max.data|default:dmax }}]"
             data-slider-tooltip="hide"/>
      <div class="slider-years">
        <div class="slider-min">
          <!-- <label for="year-min">From</label> -->
          <input id="year-min" type="number"
                 name="{{ form.xdate_min.name }}"
                 value="{{ form.xdate_min.data }}"
                 min="{{ dmin }}"
                 max="{{ dmax }}"
                 placeholder="From {{ dmin }}">
        </div>
        <div class="slider-max">
          <!-- <label for="year-max">To</label> -->
          <input id="year-max" type="number"
                 name="{{ form.xdate_max.name }}"
                 value="{{ form.xdate_max.data }}"
                 min="{{ dmin }}"
                 max="{{ dmax }}"
                 placeholder="To {{ dmax }}">
        </div>
      </div>
{% endwith %}

  </div>
</fieldset>


{% if form.has_treaty %}
<fieldset class="special-filter">
    <h5 data-toggle="collapse" {% if not form.has_treaty %}class="collapsed"{% endif %}
        data-target="#filter-treaties">Treaty filters</h5>

    <div id="filter-treaties" class="collapse {% if form.has_treaty %}in{% endif %}">

{% include 'bits/checkbox_facet.html' with title="Document type" facet=facets.tr_type_of_document field=form.tr_type_of_document show_empty=True %}

{% include 'bits/checkbox_facet.html' with title="Field of application" facet=facets.field_of_application field=form.tr_field_of_application show_empty=True %}

{% include 'bits/checkbox_facet.html' with title="Status" facet=facets.tr_status field=form.tr_status show_empty=True %}

{# TODO: this is badly named deposit*o*ry in code #}
{% include "bits/selection_facet.html" with title="Depositary" placeholder="Add depositary…" viewname="api:tr-depository-list" facet=facets.tr_depository field=form.tr_depository op_field=form.tr_depository_and_ %}

{% include "bits/selection_facet.html" with title="Place of adoption" placeholder="Add place…" viewname="api:tr-place-of-adoption-list" facet=facets.tr_place_of_adoption field=form.tr_place_of_adoption op_field=form.tr_place_of_adoption_and_ %}

    </div>
</fieldset>
{% endif %}


{% if form.has_decision %}
  <fieldset class="special-filter">
    <h5 data-toggle="collapse" {% if not form.has_decision %}class="collapsed"{% endif %}
        data-target="#filter-cop-decisions">COP Decision filters</h5>

    <div id="filter-cop-decisions" class="collapse {% if form.has_decision %}in{% endif %}">

{% include "bits/selection_facet.html" with title="Treaty" placeholder="Add treaties…" viewname="api:dec-treaty-name-list" facet=facets.dec_treaty_name field=form.dec_treaty_name op_field=form.dec_treaty_name_and_ %}

{% if facets.dec_type_of_document.results %}
{% include 'bits/checkbox_facet.html' with title="Type of document" facet=facets.dec_type_of_document field=form.dec_type_of_document %}
{% endif %}

{% include 'bits/checkbox_facet.html' with title="Decision status" facet=facets.dec_status field=form.dec_status show_empty=True %}

    </div>
</fieldset>
{% endif %}


{% if not form.type.data or form.has_court_decision %}
  <fieldset class="special-filter">
    <h5 data-toggle="collapse" {% if not form.has_court_decision %}class="collapsed"{% endif %}
        data-target="#filter-court-decisions">Court decision filters</h5>
    <div id="filter-court-decisions" class="collapse {% if form.has_court_decision %}in{% endif %}">

{% include 'bits/checkbox_facet.html' with title="Type of court" facet=facets.cd_type_of_document field=form.cd_type_of_document show_empty=True %}

{% include "bits/selection_facet.html" with title="Sub-national/state level" placeholder="Add territory…" viewname="api:cd-territorial-subdivision-list" facet=facets.cd_territorial_subdivision field=form.cd_territorial_subdivision op_field=form.cd_territorial_subdivision_and_ %}

    </div>
  </fieldset>
{% endif %}


{% if form.has_legislation %}
  <fieldset class="special-filter">
    <h5 data-toggle="collapse" {% if not form.has_legislation %}class="collapsed"{% endif %}data-target="#filter-legislation">Legislation filters</h5>
    <div id="filter-legislation" class="collapse {% if form.has_legislation %}in{% endif %}">

{% include 'bits/checkbox_facet.html' with title="Document type" facet=facets.leg_type_of_document field=form.leg_type_of_document show_empty=True %}

{% include "bits/selection_facet.html" with title="Sub-national/state level" placeholder="Add territory…" viewname="api:leg-territorial-subdivision-list" facet=facets.leg_territorial_subdivision field=form.leg_territorial_subdivision op_field=form.leg_territorial_subdivision_and_ %}

    </div>
  </fieldset>
{% endif %}


{% if form.has_literature %}
  <fieldset class="special-filter">
    <h5 data-toggle="collapse" {% if not form.has_literature %}class="collapsed"{% endif %} data-target="#filter-literatures">Literature filters</h5>
    <div id="filter-literatures" class="collapse {% if form.has_literature %}in{% endif %}">

{% include "bits/selection_facet.html" with title="Author" placeholder="Add author…" viewname="api:lit-author-list" facet=facets.lit_author field=form.lit_author op_field=form.lit_author_and_ %}

{% include "bits/selection_facet.html" with title="Journal/Series" placeholder="Add journal/series…" viewname="api:lit-orig-serial-title-list" facet=facets.lit_orig_serial_title field=form.lit_orig_serial_title op_field=form.lit_orig_serial_title_and_ %}

{% include "bits/selection_facet.html" with title="Publisher" placeholder="Add publisher…" viewname="api:lit-publisher-list" facet=facets.lit_publisher field=form.lit_publisher op_field=form.lit_publisher_and_ %}

{% include "bits/selection_facet.html" with title="Document type" placeholder="Add document type…" viewname="api:lit-type-of-text-list" facet=facets.lit_type_of_text field=form.lit_type_of_text op_field=form.lit_type_of_text_and_ %}

    </div>
  </fieldset>
{% endif %}



<input class="btn btn-default btn-sm btn-block" type="reset" value="Reset all filters">
